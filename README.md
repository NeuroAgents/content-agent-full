# Микросервис обработки контента с Gemini API

Этот микросервис предназначен для обработки контента из базы данных Supabase, извлекая статьи, очищая HTML, переписывая и переводя контент с помощью Google Gemini API.

## Функциональность

- Загрузка необработанных статей из базы данных
- Очистка HTML от ненужных элементов с помощью BeautifulSoup
- Переписывание контента в профессиональном стиле с помощью Gemini API
- Перевод контента на русский язык с помощью Gemini API
- Обновление статей в базе данных с обработанным контентом

## Подготовка к использованию

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Настройка окружения

Создайте файл `.env` на основе `.env.example`:

```bash
cp .env.example .env
```

Отредактируйте файл `.env`, указав необходимые параметры:

- `SUPABASE_URL` - URL вашего проекта в Supabase
- `SUPABASE_KEY` - API ключ для доступа к Supabase
- `GEMINI_API_KEY` - API ключ для доступа к Google Gemini API

### Обновление структуры базы данных

Выполните SQL-скрипт для обновления структуры таблицы `content_items` в Supabase:

```bash
# Вам необходимо применить migration_update_content_items.sql
# через интерфейс Supabase или с помощью CLI
```

## Использование

### Запуск обработки контента

```bash
python content_processor.py --limit 5
```

Где `5` - это максимальное количество статей для обработки за один запуск.

### Режим dry-run

Для тестирования без внесения изменений в базу данных:

```bash
python content_processor.py --limit 2 --dry-run
```

## Принцип работы

1. Скрипт получает список необработанных статей из базы данных (статьи, у которых `is_cleaned = false` и поле `content` не пусто)
2. Для каждой статьи:
   - Очищает HTML от скриптов, стилей и форматирования
   - Переписывает контент с помощью Gemini API, сохраняя важную информацию
   - Переводит переписанный контент на русский язык
   - Обновляет запись в базе данных, устанавливая флаги `is_cleaned = true` и `is_translated = true`

## Мониторинг

Скрипт выводит подробные логи о процессе обработки в консоль, что позволяет отслеживать успешность обработки статей и выявлять возможные проблемы.
